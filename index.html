<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <link rel="stylesheet" href="mainCSS.css">
  
  <!-- Author: Aaron Scher-->

  </head>
  <!-- When the page is finished loading, execute the button functions:-->
  <body onload="initFunction()"> 

<button id = "openbtn" class="openbtn" onclick="openNav()">&#9776; Close Sidebar</button>


<div id = "mySideBar" class="sideBar">


  <div class="variableSubTitle" style="text-align:center; "> Input data 
  </div>
  <div class="variableSubTitle"> Source/load: 
  </div>
  <div class="variableLabel">
      <label for="sourceType">Source type:</label>
      <select id="source" onchange="sourceSelectFunction()" class="pullDownMenu">
        <option value="1" class="textInput">Constant voltage</option>
        <option value="2" class="textInput">Constant current</option>
      </select>
  </div>
  <div class = "variableLabel"><label id="sourceTypeLabel"> &nbsp;&nbsp;Source voltage (DC), <span style='font-family:Times New Roman'><i>V</i><sub>g</sub> </span>  (V):</label><input type="text" id="Vg_Ig" value="500" class="textInput" onchange="updateHash()">
  </div>
 
  <div class="variableLabel">
       <label for="loadType">Load type:</label>
       <select id="load" onchange="loadSelectFunction()" class="pullDownMenu">
        <option value="1" class="textInput">Constant resistance</option>
        <option value="2" class="textInput">Constant voltage</option>
        <option value="3" class="textInput">Constant current</option>
        <option value="4" class="textInput">Constant power (V driven)</option>  
        <option value="5" class="textInput">Constant power (I driven)</option>
      </select>
  </div>
  
    <div class="variableLabel"><label id="loadTypeLabel"> Load resistance, <span style='font-family:Times New Roman'><i> R<sub>L</sub> </i></span> (<span style='font-family:Times New Roman'>&#8486;</span>): </label><input type="text" id="RL_VL_IL_PL" value="5" class="textInput" onchange="updateHash()">
    </div>
    <div class="variableLabel">
      <label for="inverter">Inverter type:</label>
      <select name="inverter" id="inverter" class="pullDownMenu" onchange="updateHash()"> 
        <option value="1">Half-bridge inverter</option>
        <option value="2">Full-bridge inverter</option>
    </select>
  </div>
    <div class="variableLabel">&nbsp;&nbsp;FET on-resistance (<span style='font-family:Times New Roman'>&#8486;</span>): <input type="text" id="Ron" value="!" class="textInput" onchange="updateHash()">
  </div>

  <div class="variableLabel">
    <label for="rectifier"></label>Rectifier type:</label>
    <select name="rectifier" id="rectifier" class="pullDownMenu" onchange="updateHash()"> 
      <option value="1" >Half-wave rectifier</option>
      <option value="2" >Full-wave rectifier</option>
    </select>
  </div>

  <div class="variableLabel">&nbsp;&nbsp;Diode forward volt drop (V): <input type="text" id="Vfwd" value="!" class="textInput" onchange="updateHash()">
  </div>
  <div class="variableSubTitle"> Resonators: &nbsp;&nbsp;<a href="#resonatorCalculator"><img id="calculatorIcon" src="images/calculatorIcon.png"></a>  
  </div>
 
   <div class="variableLabel">
    <label for="compensation"></label>Compensation:</label>
    <select name="compensation" id="compensation" class="pullDownMenu" onchange="updateHash()"> 
      <option value="1" >Series-series</option>
      <option value="2" >Series-parallel</option>
      <option value="3" >LCC-series</option>
      <option value="4" >LCC-LCC</option>
    </select>
  </div>

  

   
<div class="variableLabel"><b><i>Primary:</i></b></Primary></div>
<div id = "lccSeriesButtonDisplayArea"> 
    <div id="sideBarResonatorInputs">
    <div class="variableLabel"><span style='font-family:Times New Roman'><i>L</i><sub>f1</sub> </span> (H): <input type="text" id="Lf1" value="3.7e-5" class="textInput" onchange="updateHash()">
  </div>
  <div class="variableLabel"> <span style='font-family:Times New Roman'><i>R</i><sub>Lf1</sub> </span> (<span style='font-family:Times New Roman'>&#8486;</span>): <input type="text" id="RLf1" value="45e-3" class="textInput" onchange="updateHash()">
  </div>

    <div class="variableLabel"><span style='font-family:Times New Roman'><i>C</i><sub>f1</sub> </span> (F): <input type="text" id="Cf1" value="3.7e-5" class="textInput" onchange="updateHash()">
  </div>
  <div class="variableLabel"><span style='font-family:Times New Roman'><i>R</i><sub>Cf1</sub> </span> (<span style='font-family:Times New Roman'>&#8486;</span>: <input type="text" id="RCf1" value="45e-3" class="textInput" onchange="updateHash()">
  </div>
  </div>
  </div>
<div id="sideBarResonatorInputs">
  <div class="variableLabel"><span style='font-family:Times New Roman'><i>L</i><sub>1</sub> </span> (H): <input type="text" id="L1" value="3.7e-5" class="textInput" onchange="updateHash()">
  </div>
  <div class="variableLabel"><span style='font-family:Times New Roman'><i>R</i><sub>L1</sub> </span> (<span style='font-family:Times New Roman'>&#8486;</span>): <input type="text" id="RL1" value="45e-3" class="textInput" onchange="updateHash()">
  </div>
  <div class="variableLabel"><span style='font-family:Times New Roman'><i>C</i><sub>1</sub> </span> (F): <input type="text" id="C1" value="9.48e-5" class="textInput" onchange="updateHash()">
  </div>
 <div class="variableLabel"><span style='font-family:Times New Roman'><i>R</i><sub>C1</sub> </span> (<span style='font-family:Times New Roman'>&#8486;</span>): <input type="text" id="RC1" value="45e-3" class="textInput" onchange="updateHash()">
  </div>
</div>
  <div class="variableLabel"><b><i>Secondary:</i></b></Primary></div>
<div id = "lccLCCButtonDisplayArea"> 
         <div id="sideBarResonatorInputs">

     <div class="variableLabel"><span style='font-family:Times New Roman'><i>L</i><sub>f2</sub> </span> (H): <input type="text" id="Lf2" value="3.7e-5" class="textInput" onchange="updateHash()">
  </div>
  <div class="variableLabel"><span style='font-family:Times New Roman'><i>R</i><sub>Lf2</sub> </span> (<span style='font-family:Times New Roman'>&#8486;</span>): <input type="text" id="RLf2" value="45e-3" class="textInput" onchange="updateHash()">
  </div>

    <div class="variableLabel"><span style='font-family:Times New Roman'><i>C</i><sub>f2</sub> </span> (F): <input type="text" id="Cf2" value="3.7e-5" class="textInput" onchange="updateHash()">
  </div>
  <div class="variableLabel"><span style='font-family:Times New Roman'><i>R</i><sub>Cf2</sub> </span> (<span style='font-family:Times New Roman'>&#8486;</span>): <input type="text" id="RCf2" value="45e-3" class="textInput" onchange="updateHash()">
  </div>
</div>
</div>

<div id="sideBarResonatorInputs">
  <div class="variableLabel"><span style='font-family:Times New Roman'><i>L</i><sub>2</sub> </span> (H): <input type="text" id="L2" value="3.7e-5" class="textInput" onchange="updateHash()">
  </div>
  <div class="variableLabel"><span style='font-family:Times New Roman'><i>R</i><sub>L2</sub> </span> (<span style='font-family:Times New Roman'>&#8486;</span>): <input type="text" id="RL2" value="45e-3" class="textInput" onchange="updateHash()">
  </div>
  <div class="variableLabel"><span style='font-family:Times New Roman'><i>C</i><sub>2</sub> </span> (F): <input type="text" id="C2" value="1e-3" class="textInput" onchange="updateHash()">
  </div>
  <div class="variableLabel"><span style='font-family:Times New Roman'><i>R</i><sub>C2</sub> </span> (<span style='font-family:Times New Roman'>&#8486;</span>): <input type="text" id="RC2" value="1e-3" class="textInput" onchange="updateHash()">
  </div>
  </div>

  <div class="variableLabel">Coupling coefficient, <span style='font-family:Times New Roman'><i>k</i></span>  <input type="text" id="k" value=".21" class="textInput" onchange="updateHash()">
  </div>

  <div class="variableSubTitle"> Frequency sweep analysis:  
  </div>
  <div class="variableLabel">Low plot freq. limit (Hz): <input type="text" id="fmin" class="textInput" onchange="updateHash()">
  </div>
  <div class="variableLabel">High plot freq. limit (Hz): <input type="text" id="fmax" value="90e3" class="textInput" onchange="updateHash()">
  </div>
  <div class="variableLabel">Number of data plot points: <input type="text" id="fnum" value="1000" class="textInput" onchange="updateHash()">
  </div>

   <div class="variableSubTitle"> Time-domain analysis:
   </div>

<div class="variableLabel">
      <label for="enableTimeDomainChoice">Time-domain analysis:</label>
      <select name="enableTimeDomainChoice" id="enableTimeDomainChoice" class="pullDownMenu" onchange="updateHash()"> 
        <option value="1">Enable</option>
        <option value="2">Disable</option>
    </select>
  </div>



<div id="TimeDomainInputtext">
  <div class="variableLabel">Operating frequency (Hz) <input type="text" id="f0" class="textInput" onchange="updateHash()">
  </div>
  <div class="variableLabel">Number of odd harmonics <input type="text" id="numHarmonics" class="textInput" onchange="updateHash()">
  </div>
   <div class="variableLabel">Solver's max iteration limit <input type="text" id="numIterations" class="textInput" onchange="updateHash()">
  </div>
    

<div class="variableLabel">
      <label for="rampUpChoice">Initializaton options to help convergence:</label>
      <select name="rampUpChoice" id="rampUpChoice" class="pullDownMenu" onchange="updateHash()"> 
        <option value="1">Basic</option>
        <option value="2">Thevenin method</option>
        <option value="3">Ramp-up method</option>
        <option value="4">Hybrid Thevenin/Ramp-up</option>
    </select>
  </div>


  </div>
  <p></p>

<button type="button" class="buttonStyle1" onclick="resetAll()">Reset</button>
<button type="button" class = "buttonStyle1" onclick="buttonFunction(1)">Download output as CSV</button>
<p></p>


</div>



<div id="main">


<div class="heading">
<h2>Calculator for inductive power transfer systems</h2> 
Developed and maintained by Aaron Scher (aaron.scher@oit.edu). <a href="https://www.linkedin.com/in/aaronscher/"><img id="linkedInIcon" src="images/linkedInIcon.png"></a>  
  </div>
  <br>

<p><b>Directions:</b>  This is an online calculator to aid in the design of inductive power transfer (IPT) systems.
Change the system parameters in left sidebar to generate updated frequency response plots. All AC magnitude values are peak (not RMS). Hover your cursor over a plot below to enable additional interactivity and options.</p>

For convenience, you can also select an IPT system configuration from a variety of "presets" from the dropdown list below. 
After you select a preset configuration, the calculator will populate the system parameters in the left side menu 
with the corresponding values and analyze. 
<div class="variableLabel">
      <label for="presetChoice">Select a preset:</label>
      <select name="presetChoice" id="presetChoice" class="pullDownMenu" onchange="presetFun()"> 
        <option value="1">Default</option>
        <option value="2">V.P. Galigekere, et al., LCC-series, 22 kHz, 10kW, k=0.265, Oak Ridge National Lab, 2018. </option>
        <option value="3">Y. Fang, et al., series-series, 10W, 80 kHz, k=0.6, University of Hong Kong, 2019.</option>
        <option value="4">A. Scher, et al., series-series, 5W CPL, 175.5 kHz, k=0.206, Oregon Tech, 2020.</option>
    </select>
  </div>
  <div id="presetDescription">
  </div>


<div class="imageRow">
  <div class="imageColumn">
   <img id="sourceImage" class = "image">
  </div>
  <div class="imageColumn">
    <img id="inverterImage" class="image">
  </div>
  <div class="imageColumn">
    <img id="couplerImage" class="image"> 
  </div>
  <div class="imageColumn">
      <img id="rectifierImage" class="image">
  </div>
    <div class="imageColumn">
      <img id="loadImage" class="image">
  </div>
</div>


<br>
<div id="resultsMessage">
</div>   

<div id="errorMessage">
</div>





<div class="grid-container-plots ">

  <div id="efficiencyPlot" class = "plotStyle" ></div>
  <div id="inputOutputPowerPlot" class = "plotStyle"></div>
  <div id="sourceLoadVoltagePlot" class="plotStyle"></div>
  <div id="sourceLoadCurrentPlot" class="plotStyle"></div>
  <div id="loadResistancePlot" class="plotStyle"></div>
  <div id="acCurrentPlot" class="plotStyle"></div>
  <div id="acVoltPlot" class="plotStyle"></div>
  <div id="zinPhasePlot" class="plotStyle"></div>
  <div id="zinMagPlot" class="plotStyle"></div>
  <div id="capacitorVoltPlot" class="plotStyle"></div>
  <div id="inverterRectifierPowerLossPlot" class="plotStyle"></div>
  <div id="capacitorPowerLossPlot" class = "plotStyle"></div>
  <div id="inductorPowerLossPlot" class = "plotStyle"></div>
  <div id="inductorCurrentPlot" class="plotStyle"></div>
  <div id="capacitorCurrentPlot" class="plotStyle"></div>
</div>

<h3>Multi-harmonic time-domain analysis results:</h3>
<div id="time-domain-enable-message"></div>
<div id="time-domain-area">
<div class="time-domain-plots">
    <div id="timeDomainPlot" class = "plotStyle2" ></div>
</div>

<div id = "timeDomainMessage"></div>
</div>

<div id="resonatorCalculator">
<h3>LC resonator calculator</h3>
<p> This small calculator (contained within this box) computes the resonant frequency and equivalent series resistances (ESRs) for a lossy LC resonator (series or parallel).</p>
<b>Component values and resonant frequency:</b><br>
</br>

Choose two values below by checking the radio button to its side. Press calculate to solve for the other value.<br><br>
  <input type="radio" id="A" checked onclick="clickA()">Inductance, <span style='font-family:Times New Roman'><i>L</i> </span> (H): <input type="text" id="LCalcInductance" value="37e-6" class="textInput">
<br>
  <input type="radio" id="B" checked onclick="clickB()">Capacitance, <span style='font-family:Times New Roman'><i>C</i> </span> (F): <input type="text" id="CCalcCapacitance" value="9.5e-8" class="textInput">
<br>
  <input type="radio" id="C" unchecked onclick="clickC()">Resonant frequency, <span style='font-family:Times New Roman'><i>f</i><sub>0</sub> </span> (Hz) = <input type="text" id="resFreqCalc" style='width: 70px;' class="textInput">
</br>

</br>
<b>Component losses</b><br>
</br>
Select the loss of the inductor and capacitor below. Press calculate to find the individual ESRs and unloaded Q-factor. 
<br><br>
<label for="indLossTypeCalc">Inductor loss specification:</label>
  <select id="indLossTypeCalc" onchange="indLossTypeCalcFunction()" class="pullDownMenu">
  <option value="1" class="textInput">Inductor ESR</option>
  <option value="2" class="textInput">Inductor Q-factor at resonance</option>
  <option value="3" class="textInput">Inductor dissipation factor (tan&#948;) at resonance</option>
  </select>

  <div class="LcCalculatorLabel"><label id ="lcCalcIndLossText"> &nbsp;&nbsp;&nbsp;Inductor's series resistance, <span style='font-family:Times New Roman'><i>R</i><sub>L</sub> </span> (<span style='font-family:Times New Roman'>&#8486;</span>): </label><input type="text" id="LCalcLoss" value="45e-3" class="textInput">

  </div>
  

  <label for="capLossTypeCalc">Capacitor loss specification:</label>
  <select id="capLossTypeCalc" onchange="capLossTypeCalcFunction()" class="pullDownMenu">
  <option value="1" class="textInput">Capacitor ESR</option>
  <option value="2" class="textInput">Capacitor Q-factor at resonance</option>
  <option value="3" class="textInput">Capacitor dissipation factor (tan&#948;) at resonance</option>
  </select>
  <div class="LcCalculatorLabel"><label id ="lcCalcCapLossText">&nbsp;&nbsp;&nbsp;Capacitor's series resistance, <span style='font-family:Times New Roman'><i>R</i><sub>C</sub> </span> (<span style='font-family:Times New Roman'>&#8486;</span>):</label> <input type="text" id="CCalcLoss" value="1e-3" class="textInput">
  </div>
  <br>
<button type="button" class="buttonStyle2" onclick="calculateLCResonatorCalc()">Calculate</button>
<button type="button" class = "buttonStyle2" onclick="populatePrimaryCalc()">Populate primary</button>
<button type="button" class = "buttonStyle2" onclick="populateSecondaryCalc()">Populate secondary</button>
<!-- <button type="button" id = "resetButtonAncillaryCalc" class = "buttonStyle2" onclick="resetLCResonatorCalc()">Reset</button>
 -->
<button type="button" id = "resetButton2" class = "buttonStyle2">Reset</button>


<br>
<div id = "QfactorMessage">
</div>
<br>

Inductor ESR <span style='font-family:Times New Roman'><i>R</i><sub>L</sub></span> = <input type="text" id="RLCalc" style='width: 70px;' class="textInput">
<br>
Capacitor ESR <span style='font-family:Times New Roman'><i>R</i><sub>C</sub></span> = <input type="text" id="RCCalc" style='width: 70px;' class="textInput">


</div>
<h3>Simplifying assumptions</h3>
<p>This calculator makes the following simplifying assumpitons for analyzing the IPT system and generating the plots:
<ul>

<li><b>Simple inverter FET model</b> Only the on-resistances of the inverter FETs are considered.The calculator ignores other FET switching loss mechanisms, parasitics and nonlinearities.</li>
<li><b>Simple diode model</b> Only diode forward voltage drops are considered.The calculator ignores other diode loss mechanisms, parasitics and nonlinearities.</li>
<li><b>First-harmonic approximation for frequency analysis.</b> The calculator ignores higher-order harmonics for the frequency sweeps. However, higher-order harmonics are included in the time-domain analysis.</li>
<li><b>Reactive component frequency dispersion ignored.</b> The calculator assumes the inductance, capacitance, and Q-factors of the resonators remain constant over the frequency range of interest.</li>
<li><b>Stable equilibrium operation assumed.</b> Constant power loads can potentially cause instability. However, the calculator assumes the IPT system operates at stable equilibrium for all loading conditions.</li>
</ul>
</p>

<h2>Contributors</h2>

The developer of this calculator is Aaron Scher (aaron.scher@oit.edu).
Please contact me with your comments or if you find any bugs in the program or have suggestions for improvement. 
I would like to thank Mostak Mohammad for his valuable feedback and helpful discussions.



<h2>To-do list</h2>
<ul>
<li>Add more preset configurations.</li>
<li>Extend time-domain analysis to voltage load type.</li>
<li>Extend time-domain analysis to series-parallel compensation.</li>
</ul>

<h2>References</h2>
<p>
This calculator performs circuit analysis by finding the ABCD-parameters of the AC circuit and solving for unknown signals given the specified loading and source conditions. A discussion of constant power loads (i.e., "voltage driven" versus "current driven") are found in [1]. This calculator uses the transfer functions of inverters and rectifiers presented in [2] and [3]. A classic textbook that provides an in depth treatement of resonantors, Q factors, and related conversion formulas is [4]. 

    
<ul style="list-style-type:none; padding-left: 0;">
<li>[1] A. D. Scher, M. Kos̆ík, P. Pham, D. Costinett and E. Hossain, "Stability Analysis and Efficiency Optimization of an Inductive Power Transfer System With a Constant Power Load," in IEEE Access, vol. 8, pp. 209762-209775, 2020.</li><br/>
<li>[2] R. W. Erickson and D. Maksimoviä, Fundamentals of Power Electronics, Boston, MA, USA:Springer, 2001.</li><br/>
<li>[3] M. K. Kazimierczuk and D. Czarkowski, Resonant Power Converters, Hoboken, NJ, USA:Wiley, 2011.</li><br/>
<li>[4] H. L. Kraus, C. W. Bostian, F. H. Raab, Solid State Radio Engineering, New York, USA: Wiley, 1980.</li><br/>
</ul>
</p>
</div>
</div>

<script src="https://unpkg.com/mathjs@9.0.0/lib/browser/math.js"></script> <!-- load Mathjs library-->
<script type="text/javascript" src="https://cdn.plot.ly/plotly-latest.min.js"></script> <!-- Plotly library-->  
<script type="text/javascript" src="mainScript.js"></script> <!-- Contains the main custom js functions and objects that analyzes the circuit-->
<script type="text/javascript" src="plotsGenerateScript.js"></script> <!-- Contains custom js function for generating the plots using Plotly-->
<script type="text/javascript" src="setImageScript.js"></script> <!-- Contains custom js function for generating the png image of the system-->
<script type="text/javascript" src="hashScript.js"></script> <!-- Contains custom js functions for working with the URL hash string-->
<script type="text/javascript" src="lcResCalcScript.js"></script> <!-- Contains custom js functions for implementing the little LC resonator calcultor-->
<script type="text/javascript" src="UIScript.js"></script> <!-- Controls user interface things like the sticky button that asks to close sidebar or not, etc.-->
<script type="text/javascript" src="CSVScript.js"></script> <!-- Implements the download output as CSV button function .-->
<script type="text/javascript" src="timeDomainSimScript.js"></script> <!-- Implements the download output as CSV button function .-->
<script type="text/javascript" src="plotAndDisplayTimeSimResults.js"></script> <!-- Contains custom js function for generating the plots using Plotly-->
<script type="text/javascript" src="presetScript.js"></script> <!-- Contains custom js function for generating preset configuraitons-->

</body>
</html>



<!-- To update (add/subtract/modify) values to the sidebar: 
1. First update hashScript.js ... namely update the following variables:
hashNames 
hashDefaultValues

2. Update buttonFunction() in mainScript.js where we get the values from the sidebar using document.getElementById

3. Update resultsMessage in mainScript.js as needed 

-->

